var surface = [];
current = 0;
class FloorMap {
    constructor(s) {
        this.row = s.length;
        this.col = s[0].length;
        this.data = s;
    }

    get cubeUnit() {
        return 50;
    }

    giveFloorPosition() {
        var points = []
        for (var i=0; i<this.row; ++i) {
            for (var j=0; j<this.col; ++j) {
                if (this.data[i][j] === 'x') {
                    points.push([j * this.cubeUnit, i * this.cubeUnit]);
                }
            }
        }
        return points;
    } 

    check(x, z) {
        // console.log(x, z);
        var j = Math.round((x + 1000) / 50);
        var i = Math.round((z + 1000) / 50);
        if (this.data[i][j] === 'x') {
            return true;
        }
        return false;
    }

    static init() {
        for (var i=0; i<mapStrings.length; ++i) {
            surface.push(new FloorMap(mapStrings[i]));
        }
    }
}

var mapStrings = [
    [
        ".....x..................................",
        "...xxxxx................................",
        "x......x................................",
        "x......x................................",
        "x......xxxxxxxx.........................",
        "x............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "x...................x...................",
        "x......xxxxx........x........xxxx......x",
        "xxxxxxxxx..x........x........x..x......x",
        "........x..x........x........x..x......x",
        "........x..x........x........xxxx......x",
        "x.......xxxx........x..................x",
        "x...................x..................x",
        "x...................xxxxxxxxxxxxxxxxxxxx",
        "x.....................x.....x..........x",
        "x....xxxxxxxxxxxxxxxxxxx...............x",
        "xxxxxxxx...............................x",
        "x......x...............................x",
        "x......x...............................x",
        "x......xxxxxxxx........................x",
        "x............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "x...................x..................x",
        "x.....xxxxx.........x..................x",
        "......x...x.........x..................x",
        "......x...x.........x..................x",
        "......x..xxxx.......x..................x",
        "......x......x......x..................x",
        "......xxxxxxxx......x..................x",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "....................xxx.....x...........",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
    ],
    [
        ".....x..................................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
        ".....xxxxxxxxxxxxxxxxxxx................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "....................xxx.....x...........",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
    ],
    [
        ".....x..................................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
        ".....xxxxxxxxxxxxxxxxxxx................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "....................xxx.....x...........",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
    ],
    [
        ".....x..................................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
        ".....xxxxxxxxxxxxxxxxxxx................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "....................xxx.....x...........",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
    ],
    [
        ".....x..................................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
        ".....xxxxxxxxxxxxxxxxxxx................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "....................xxx.....x...........",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
    ],
    [
        ".....x..................................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
        ".....xxxxxxxxxxxxxxxxxxx................",
        "...xxxxx................................",
        ".......x................................",
        ".......x................................",
        ".......xxxxxxxx.........................",
        ".............xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "....................xxx.....x...........",
        "....................x...................",
        "....................x...................",
        "....................x...................",
        "....................xxxxxxxxxxxxxxxxxxxx",
        "......................x.....x...........",
    ],
]


class GeoFactory {
    constructor() {
        this.cubes = new Map(); // a dictionary
    }

    createFloor(color) {
        var geo = new THREE.PlaneGeometry(2000, 2000, 20, 20);
        var mat = new THREE.MeshPhongMaterial({
            color:color,
            transparent:true,
            opacity:.3,
            shading:THREE.FlatShading,
        });
        var floor = new THREE.Mesh(geo, mat);
        floor.receiveShadow = true;
        return floor;
    }

    createCube(color) {
        var geo = new THREE.CubeGeometry(cubeUnit, cubeUnit, cubeUnit);
        var mat = new THREE.MeshPhongMaterial({
            overdraw: true, 
            color: color,
            transparent:true,
            opacity:.8,
        });
        var cube = new THREE.Mesh(geo, mat);
        this.cubes.set(color, cube);
        return cube;
    }

    static getCube(color) {
        if (this.cubes.has(color)) {
            return this.cubes.get(color);
        }
        else {
            return this.createCube(color);
        }
    }

}